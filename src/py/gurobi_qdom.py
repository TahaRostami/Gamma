import gurobipy as gp
from gurobipy import GRB

def solve_queen_domination(n,num_threads=1):
    model = gp.Model("QueenDomination")

    model.setParam(GRB.Param.Threads, num_threads)

    # Decision variables
    x = model.addVars(n * n, vtype=GRB.BINARY, name="x")

    # Objective function: Minimize the number of queens
    model.setObjective(gp.quicksum(x[v] for v in range(n * n)), GRB.MINIMIZE)

    # Constraints: Each square must be dominated
    for r in range(n):
        for c in range(n):
            model.addConstr(gp.quicksum(x[i] for i in get_queen_positions(n, r, c)) >= 1)

    model.optimize()

    queens = [v for v in range(n * n) if x[v].x > 0.5]

    return queens

def get_queen_positions(n, row, col):
    positions = []

    positions.append(row * n + col)

    for i in range(n):
        positions.append(row * n + i)
        positions.append(i * n + col)

    for i in range(n):
        if 0 <= row + i < n and 0 <= col + i < n:
            positions.append((row + i) * n + col + i)
        if 0 <= row - i < n and 0 <= col + i < n:
            positions.append((row - i) * n + col + i)
        if 0 <= row + i < n and 0 <= col - i < n:
            positions.append((row + i) * n + col - i)
        if 0 <= row - i < n and 0 <= col - i < n:
            positions.append((row - i) * n + col - i)

    return positions


n = 15
queens = solve_queen_domination(n,num_threads=1)

# Print the result
print("Queen Positions:", queens)


# A sample of an execution

# Restricted license - for non-production use only - expires 2025-11-24
# Set parameter Threads to value 1
# Gurobi Optimizer version 11.0.0 build v11.0.0rc2 (win64 - Windows 10.0 (19045.2))
#
# CPU model: 11th Gen Intel(R) Core(TM) i5-11400H @ 2.70GHz, instruction set [SSE2|AVX|AVX2|AVX512]
# Thread count: 6 physical cores, 12 logical processors, using up to 1 threads
#
# Optimize a model with 225 rows, 225 columns and 10585 nonzeros
# Model fingerprint: 0x782a6679
# Variable types: 0 continuous, 225 integer (225 binary)
# Coefficient statistics:
#   Matrix range     [1e+00, 7e+00]
#   Objective range  [1e+00, 1e+00]
#   Bounds range     [1e+00, 1e+00]
#   RHS range        [1e+00, 1e+00]
# Found heuristic solution: objective 14.0000000
# Presolve time: 0.01s
# Presolved: 225 rows, 225 columns, 10585 nonzeros
# Variable types: 0 continuous, 225 integer (225 binary)
#
# Root relaxation: objective 4.889541e+00, 726 iterations, 0.05 seconds (0.12 work units)
#
#     Nodes    |    Current Node    |     Objective Bounds      |     Work
#  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
#
#      0     0    4.88954    0  206   14.00000    4.88954  65.1%     -    0s
# H    0     0                      12.0000000    4.88954  59.3%     -    0s
#      0     0    4.96256    0  195   12.00000    4.96256  58.6%     -    0s
# H    0     0                      11.0000000    4.96256  54.9%     -    0s
#      0     0    4.97925    0  185   11.00000    4.97925  54.7%     -    0s
#      0     0    4.99218    0  181   11.00000    4.99218  54.6%     -    0s
#      0     0    4.99218    0  179   11.00000    4.99218  54.6%     -    0s
#      0     0    4.99218    0  190   11.00000    4.99218  54.6%     -    0s
#      0     0    4.99251    0  189   11.00000    4.99251  54.6%     -    0s
#      0     0    4.99382    0  186   11.00000    4.99382  54.6%     -    0s
#      0     0    4.99600    0  191   11.00000    4.99600  54.6%     -    0s
#      0     0    4.99664    0  188   11.00000    4.99664  54.6%     -    0s
#      0     0    4.99824    0  184   11.00000    4.99824  54.6%     -    0s
#      0     0    4.99824    0  178   11.00000    4.99824  54.6%     -    1s
#      0     0    4.99824    0  177   11.00000    4.99824  54.6%     -    1s
#      0     0    4.99824    0  181   11.00000    4.99824  54.6%     -    1s
#      0     0    4.99824    0  181   11.00000    4.99824  54.6%     -    1s
# H    0     0                       9.0000000    4.99824  44.5%     -    1s
#      0     2    4.99824    0  181    9.00000    4.99824  44.5%     -    1s
#    581   475    6.40183   18  191    9.00000    5.61244  37.6%   100    5s
#   1253   697    6.37235   27  102    9.00000    5.66509  37.1%   114   10s
#   3257  1922    7.00944   35   86    9.00000    6.28007  30.2%  82.1   15s
#   6522  4179    7.76346   40   81    9.00000    6.33900  29.6%  63.9   20s
#   9793  6459    7.65975   38   50    9.00000    6.37111  29.2%  56.4   25s
#  10203  6733    7.70250   50  181    9.00000    6.37432  29.2%  55.8   32s
#  10217  6742    7.67417   81  207    9.00000    6.37432  29.2%  55.8   35s
#  10253  6768    7.34725   31   98    9.00000    6.37432  29.2%  56.7   40s
#  10601  6907    7.48558   83   59    9.00000    6.37432  29.2%  59.6   45s
#  11756  7370    7.64214   37   48    9.00000    6.37432  29.2%  62.6   50s
#  14249  8248    7.24206   45   59    9.00000    6.37432  29.2%  60.6   55s
#  16661  9124    7.15764   34   90    9.00000    6.39325  29.0%  59.2   60s
#  19444  9890    7.79963   59   47    9.00000    6.42414  28.6%  58.1   65s
#  22420 10724    7.09745   43   94    9.00000    6.45250  28.3%  57.1   70s
#  25451 11586    7.09929   33   88    9.00000    6.48068  28.0%  56.3   75s
#  28193 12274    7.84595   51   60    9.00000    6.50828  27.7%  56.1   80s
#  31061 13199    7.16717   41   92    9.00000    6.54748  27.3%  55.9   85s
#  34051 14887    7.93304   35   51    9.00000    6.66683  25.9%  55.7   90s
#  37583 16920    7.99150   66   36    9.00000    6.94604  22.8%  54.8   95s
#  41919 19070    7.65029   28   68    9.00000    6.99197  22.3%  53.0  100s
#  45764 21046    7.59886   32   61    9.00000    7.00950  22.1%  51.7  105s
#  49833 23096    7.77935   44   73    9.00000    7.02493  21.9%  50.5  110s
#  53344 24761    7.71635   38   75    9.00000    7.03622  21.8%  49.5  115s
#  57245 26610    7.67214   38   80    9.00000    7.04814  21.7%  48.6  120s
#  59503 27695     cutoff   55         9.00000    7.05301  21.6%  48.1  125s
#  61903 28857    7.75189   44   67    9.00000    7.05824  21.6%  47.7  130s
#  63871 29743    7.75802   46   69    9.00000    7.06321  21.5%  47.4  135s
#  66313 30877    7.80928   52   71    9.00000    7.06835  21.5%  47.0  140s
#  68868 32056    7.74951   36   74    9.00000    7.07310  21.4%  46.6  145s
#  71578 33348    7.22533   49   58    9.00000    7.07821  21.4%  46.2  150s
#  74393 34658    7.72564   42   71    9.00000    7.08424  21.3%  45.8  155s
#  77238 36017    7.88068   49   67    9.00000    7.08918  21.2%  45.5  160s
#  79733 37168     cutoff   40         9.00000    7.09375  21.2%  45.3  165s
#  83444 38831    7.21832   49   93    9.00000    7.10037  21.1%  44.9  170s
#  87425 40585    7.75295   48   65    9.00000    7.10684  21.0%  44.6  175s
#  91109 42226    7.76893   38   71    9.00000    7.11198  21.0%  44.3  180s
#  95159 44001    7.81638   33   71    9.00000    7.11820  20.9%  44.0  185s
#  99160 45745    7.76095   46   68    9.00000    7.12389  20.8%  43.8  190s
#  103203 47516     cutoff   73         9.00000    7.13033  20.8%  43.6  195s
#  106727 48960    7.74782   42   65    9.00000    7.13581  20.7%  43.4  200s
#  110497 50524    7.62167   53   49    9.00000    7.14125  20.7%  43.2  205s
#  114272 52069    7.82972   62   50    9.00000    7.14651  20.6%  43.0  210s
#  117079 53200    7.73829   47   72    9.00000    7.15034  20.6%  42.9  215s
#  119695 54246    7.92153   51   76    9.00000    7.15400  20.5%  42.8  220s
#  122076 55170    7.76274   49   52    9.00000    7.15732  20.5%  42.8  225s
#  124243 56059    7.80375   55   55    9.00000    7.16064  20.4%  42.7  230s
#  126402 56938    7.70073   48   51    9.00000    7.16375  20.4%  42.6  235s
#  129166 57994    7.78748   37   79    9.00000    7.16798  20.4%  42.6  240s
#  132730 59406    7.76039   47   72    9.00000    7.17279  20.3%  42.4  245s
#  136666 60915    7.99287   54   52    9.00000    7.17887  20.2%  42.3  250s
#  139377 61987    7.71105   53   52    9.00000    7.18296  20.2%  42.3  255s
#  142897 63262    7.84570   35   76    9.00000    7.18932  20.1%  42.2  260s
#  146644 64691    7.79696   51   71    9.00000    7.19545  20.1%  42.1  265s
#  150483 66103    7.88138   41   82    9.00000    7.20182  20.0%  42.0  270s
#  154297 67478     cutoff   50         9.00000    7.20887  19.9%  42.0  275s
#  158185 68788    7.71547   54   71    9.00000    7.21696  19.8%  41.9  280s
#  162105 70175    7.86665   51   50    9.00000    7.22472  19.7%  41.9  285s
#  165667 71379    7.71969   43   53    9.00000    7.23360  19.6%  41.8  290s
#  169482 72654    7.94345   50   67    9.00000    7.24417  19.5%  41.8  295s
#  173141 73828    7.76467   41   49    9.00000    7.25582  19.4%  41.8  300s
#  177027 74933    7.91512   54   77    9.00000    7.27116  19.2%  41.8  305s
#  180717 75825    7.91875   63   63    9.00000    7.28941  19.0%  41.8  310s
#  183962 76522    7.94293   37   80    9.00000    7.30859  18.8%  41.8  315s
#  187782 77249    7.84028   57   48    9.00000    7.34381  18.4%  41.8  320s
#  191566 77750    7.76693   50   46    9.00000    7.40014  17.8%  41.8  325s
#  195829 78180    7.69604   35   55    9.00000    7.47185  17.0%  41.7  330s
#  199859 78464     cutoff   79         9.00000    7.52124  16.4%  41.8  335s
#  203470 78208    7.97956   62   47    9.00000    7.56811  15.9%  41.9  340s
#  206694 77499     cutoff   38         9.00000    7.60388  15.5%  42.0  345s
#  209889 76232     cutoff   44         9.00000    7.63526  15.2%  42.2  350s
#  212931 74971     cutoff   34         9.00000    7.65715  14.9%  42.3  355s
#  216085 73292     cutoff   46         9.00000    7.67837  14.7%  42.4  360s
#  219435 71288    7.75840   40   67    9.00000    7.69636  14.5%  42.5  365s
#  222642 69426    7.90595   46   64    9.00000    7.71084  14.3%  42.5  370s
#  225659 67740     cutoff   43         9.00000    7.72228  14.2%  42.5  375s
#  229014 65662     cutoff   59         9.00000    7.73455  14.1%  42.5  380s
#  232692 63241     cutoff   45         9.00000    7.74658  13.9%  42.4  385s
#  236417 60920     cutoff   48         9.00000    7.75739  13.8%  42.4  390s
#  239659 58632     cutoff   43         9.00000    7.76694  13.7%  42.3  395s
#  243328 56035     cutoff   55         9.00000    7.77643  13.6%  42.2  400s
#  247153 53220     cutoff   50         9.00000    7.78630  13.5%  42.1  405s
#  251178 50053     cutoff   41         9.00000    7.79595  13.4%  41.9  410s
#  255219 46756     cutoff   44         9.00000    7.80535  13.3%  41.8  415s
#  259474 43333     cutoff   52         9.00000    7.81510  13.2%  41.6  420s
#  263865 39613     cutoff   49         9.00000    7.82501  13.1%  41.4  425s
#  268287 35652     cutoff   46         9.00000    7.83516  12.9%  41.2  430s
#  272363 31924     cutoff   78         9.00000    7.84423  12.8%  41.0  435s
#  276896 27893    7.85968   49   76    9.00000    7.85397  12.7%  40.7  440s
#  281243 23847     cutoff   46         9.00000    7.86379  12.6%  40.5  445s
#  286338 19166     cutoff   53         9.00000    7.87519  12.5%  40.2  450s
#  291514 14252     cutoff   58         9.00000    7.88774  12.4%  39.8  455s
#  297233  8779     cutoff   62         9.00000    7.90312  12.2%  39.4  460s
#  303058  3251     cutoff   51         9.00000    7.92495  11.9%  39.0  465s
#
# Cutting planes:
#   Gomory: 1
#   MIR: 49
#   Flow cover: 41
#
# Explored 306560 nodes (11880008 simplex iterations) in 467.74 seconds (893.39 work units)
# Thread count was 1 (of 12 available processors)
#
# Solution count 4: 9 11 12 14
#
# Optimal solution found (tolerance 1.00e-04)
# Best objective 9.000000000000e+00, best bound 9.000000000000e+00, gap 0.0000%
# Queen Positions: [1, 21, 57, 89, 105, 137, 169, 205, 218]
